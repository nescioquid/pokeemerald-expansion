raw`
Route104_PrettyPetalFlowerShop_MapScripts::
  map_script MAP_SCRIPT_ON_TRANSITION, _Route104_PrettyPetalFlowerShop_OnTransition
  .byte 0

Route104_PrettyPetalFlowerShop_OnTransition:
  setflag FLAG_LANDMARK_FLOWER_SHOP
  goto_if_unset FLAG_MET_PRETTY_PETAL_SHOP_OWNER, Route104_PrettyPetalFlowerShop_EventScript_MoveShopOwner
  goto_if_unset FLAG_BADGE03_GET, Route104_PrettyPetalFlowerShop_EventScript_MoveShopOwner
  setflag FLAG_TEMP_1
  end

Route104_PrettyPetalFlowerShop_EventScript_MoveShopOwner::
  setobjectxyperm LOCALID_FLOWER_SHOP_OWNER, 4, 6
  end

Route104_PrettyPetalFlowerShop_EventScript_ShopOwner::
  lock
  faceplayer
  goto_if_set FLAG_TEMP_1, Route104_PrettyPetalFlowerShop_EventScript_SellDecorations
  msgbox Route104_PrettyPetalFlowerShop_Text_ThisIsPrettyPetalFlowerShop, MSGBOX_DEFAULT
  goto_if_set FLAG_MET_PRETTY_PETAL_SHOP_OWNER, Route104_PrettyPetalFlowerShop_EventScript_AlreadyMet
  setflag FLAG_MET_PRETTY_PETAL_SHOP_OWNER
  msgbox Route104_PrettyPetalFlowerShop_Text_IntroLearnAboutBerries, MSGBOX_YESNO
  call_if_eq VAR_RESULT, YES, Route104_PrettyPetalFlowerShop_EventScript_ExplainBerries
  call_if_eq VAR_RESULT, NO, Route104_PrettyPetalFlowerShop_EventScript_DontExplainBerries
  release
  end

Route104_PrettyPetalFlowerShop_EventScript_AlreadyMet::
  msgbox Route104_PrettyPetalFlowerShop_Text_LearnAboutBerries, MSGBOX_YESNO
  call_if_eq VAR_RESULT, YES, Route104_PrettyPetalFlowerShop_EventScript_ExplainBerries
  call_if_eq VAR_RESULT, NO, Route104_PrettyPetalFlowerShop_EventScript_DontExplainBerries
  release
  end

Route104_PrettyPetalFlowerShop_EventScript_ExplainBerries::
  msgbox Route104_PrettyPetalFlowerShop_Text_BerriesExplanation, MSGBOX_DEFAULT
  return

Route104_PrettyPetalFlowerShop_EventScript_DontExplainBerries::
  msgbox Route104_PrettyPetalFlowerShop_Text_FlowersBringHappiness, MSGBOX_DEFAULT
  return

Route104_PrettyPetalFlowerShop_EventScript_SellDecorations::
  message gText_PlayerWhatCanIDoForYou
  waitmessage
  pokemartdecoration2 Route104_PrettyPetalFlowerShop_Pokemart_Plants
  msgbox gText_PleaseComeAgain, MSGBOX_DEFAULT
  release
  end

  .align 2
Route104_PrettyPetalFlowerShop_Pokemart_Plants:
  .2byte DECOR_RED_PLANT
  .2byte DECOR_TROPICAL_PLANT
  .2byte DECOR_PRETTY_FLOWERS
  .2byte DECOR_COLORFUL_PLANT
  .2byte DECOR_BIG_PLANT
  .2byte DECOR_GORGEOUS_PLANT
  pokemartlistend

Route104_PrettyPetalFlowerShop_EventScript_WailmerPailGirl::
  lock
  faceplayer
  goto_if_unset FLAG_RECEIVED_WAILMER_PAIL, Route104_PrettyPetalFlowerShop_EventScript_GiveWailmerPail
  msgbox Route104_PrettyPetalFlowerShop_Text_WailmerPailExplanation, MSGBOX_DEFAULT
  release
  end

Route104_PrettyPetalFlowerShop_EventScript_GiveWailmerPail::
  msgbox Route104_PrettyPetalFlowerShop_Text_YouCanHaveThis, MSGBOX_DEFAULT
  giveitem ITEM_WAILMER_PAIL
  goto_if_eq VAR_RESULT, FALSE, Common_EventScript_ShowBagIsFull
  msgbox Route104_PrettyPetalFlowerShop_Text_WailmerPailExplanation, MSGBOX_DEFAULT
  setflag FLAG_RECEIVED_WAILMER_PAIL
  release
  end

Route104_PrettyPetalFlowerShop_EventScript_RandomBerryGirl::
  lock
  faceplayer
  dotimebasedevents
  goto_if_set FLAG_DAILY_FLOWER_SHOP_RECEIVED_BERRY, Route104_PrettyPetalFlowerShop_EventScript_AlreadyReceivedBerry
  msgbox Route104_PrettyPetalFlowerShop_Text_ImGrowingFlowers, MSGBOX_DEFAULT
  random 8
  addvar VAR_RESULT, FIRST_BERRY_INDEX
  giveitem VAR_RESULT
  goto_if_eq VAR_RESULT, 0, Common_EventScript_ShowBagIsFull
  setflag FLAG_DAILY_FLOWER_SHOP_RECEIVED_BERRY
  msgbox Route104_PrettyPetalFlowerShop_Text_MachineMixesBerries, MSGBOX_DEFAULT
  release
  end

Route104_PrettyPetalFlowerShop_EventScript_AlreadyReceivedBerry::
  msgbox Route104_PrettyPetalFlowerShop_Text_MachineMixesBerries, MSGBOX_DEFAULT
  release
  end
`

script _Route104_PrettyPetalFlowerShop_OnTransition {
  setflag(FLAG_LANDMARK_FLOWER_SHOP)
  if (!flag(FLAG_MET_PRETTY_PETAL_SHOP_OWNER)) {
    setobjectxyperm(LOCALID_FLOWER_SHOP_OWNER, 4, 6)
    setflag(FLAG_TEMP_1)
  }
  if (!flag(FLAG_RECEIVED_WAILMER_PAIL)) {
    setobjectxyperm(LOCALID_FLOWER_SHOP_WAILMER_PAIL_GIRL, 7, 3)
    setobjectmovementtype(LOCALID_FLOWER_SHOP_WAILMER_PAIL_GIRL, MOVEMENT_TYPE_WANDER_LEFT_AND_RIGHT)
    setflag(FLAG_TEMP_2)
  }
  if (!flag(FLAG_BADGE03_GET)) {
    setobjectxyperm(LOCALID_FLOWER_SHOP_OWNER, 4, 6)
    setobjectxyperm(LOCALID_FLOWER_SHOP_WAILMER_PAIL_GIRL, 7, 3)
    setobjectmovementtype(LOCALID_FLOWER_SHOP_WAILMER_PAIL_GIRL, MOVEMENT_TYPE_WANDER_LEFT_AND_RIGHT)
    setflag(FLAG_TEMP_1)
    setflag(FLAG_TEMP_2)
  }
  end
}

script _Route104_PrettyPetalFlowerShop_EventScript_RandomBerryGirl {
  lock
  faceplayer
  dotimebasedevents
  if (!flag(FLAG_DAILY_FLOWER_SHOP_RECEIVED_BERRY)) {
    msgbox(format("I'm trying to be like my big sisters. I'm growing flowers, too!\pHere you go! They're for you!"))
    if (!flag(FLAG_BADGE01_GET)) {
      giveitem(ITEM_CHILAN_BERRY, 3)
      goto_if_eq(VAR_RESULT, FALSE, Common_EventScript_ShowBagIsFull)
    } else {
      call(_Common_EventScript_GiveBerry_Resistance)
    }
    setflag(FLAG_DAILY_FLOWER_SHOP_RECEIVED_BERRY)
  }
  msgbox(format("You can plant a Berry and grow it big, or you can make a Pokémon hold it.\pBut now they have a machine that mixes up different Berries and makes candies for Pokémon.\pI want some candy, too."))
  release
  end
}

script _Route104_PrettyPetalFlowerShop_EventScript_ShopOwner {
  lock
  faceplayer
  if (flag(FLAG_TEMP_1)) {
    if (!flag(FLAG_MET_PRETTY_PETAL_SHOP_OWNER)) {
      msgbox(Route104_PrettyPetalFlowerShop_Text_ThisIsPrettyPetalFlowerShop)
      msgbox(Route104_PrettyPetalFlowerShop_Text_IntroLearnAboutBerries, MSGBOX_YESNO)
      if (var(VAR_RESULT)) {
        call(Route104_PrettyPetalFlowerShop_EventScript_ExplainBerries)
      } else {
        call(Route104_PrettyPetalFlowerShop_EventScript_DontExplainBerries)
      }
      setflag(FLAG_MET_PRETTY_PETAL_SHOP_OWNER)
    } else {
      goto(Route104_PrettyPetalFlowerShop_EventScript_AlreadyMet)
    }
    } else {
      goto(Route104_PrettyPetalFlowerShop_EventScript_SellDecorations)
    }
  release
  end
}

script _Route104_PrettyPetalFlowerShop_EventScript_WailmerPailGirl {
  lock
  faceplayer
  if (flag(FLAG_TEMP_2)) {
    if (!flag(FLAG_RECEIVED_WAILMER_PAIL)) {
      goto(Route104_PrettyPetalFlowerShop_EventScript_GiveWailmerPail)
    } else {
      msgbox(Route104_PrettyPetalFlowerShop_Text_WailmerPailExplanation)
    }
  } else {
    message(format("Been watering your Berries like I taught you? How can I help you?"))
    waitmessage
    pokemart(_Route104_PrettyPetalFlowerShop_Pokemart_Mulches)
    msgbox(format("Until next time!"))
  }
  release
  end
}

mart _Route104_PrettyPetalFlowerShop_Pokemart_Mulches {
  ITEM_GROWTH_MULCH
  ITEM_STABLE_MULCH
  ITEM_GOOEY_MULCH
  ITEM_DAMP_MULCH
}
